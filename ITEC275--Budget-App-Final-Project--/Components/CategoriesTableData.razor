@inject DataManager DataManager

<table class="table table-borderless mb-0">
    <thead>
        <tr class="table-primary align-content-center">
            <th scope="col" class="text-center"><h5 style="margin:0;">Category Name</h5></th>
            <th scope="col" class="text-center"><h5 style="margin:0;">Budget Assigned</h5></th>
            <th scope="col" class="text-center"><h5 style="margin:0;">Amount Left to Transact</h5></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var category in AllSections![DataManager.CurrentBudget!][_Section!]!)
        {
            <tr>
                <td class="text-center fw-normal align-content-center">@category.CategoryName</td>
                <td class="text-center fw-normal justify-content-center align-items-center flex-column">
                    <div class="row justify-content-center">
                        <button class="btn btn-primary col-md-4" @onclick="async () => await DataManager.CategoryCollapseDictionary![category].ToggleAsync()">Add</button>
                    </div>
                    <div class="row justify-content-center">
                        <Collapse class="col-md-12" @ref="DataManager.CategoryCollapseDictionary![category]" OnHiding="UpdateState">
                            <Card>
                                <CardBody>
                                    <AssignBudget AllSections=AllSections CollapseObj="DataManager.CategoryCollapseDictionary![category]" _Section="_Section" _CurrentCategory="category" RefreshParentState="RefreshParentState"/>
                                </CardBody>
                            </Card>
                        </Collapse>
                    </div>
                </td>
                <td class="text-center fw-normal align-content-center">
                    $@String.Format("{0:0.00}", DataManager.CalculateCategoryLeftToTransact(AllSections.Keys.FirstOrDefault(x => x.BudgetId == DataManager.CurrentBudget!.BudgetId!)!, category))
                </td>
            </tr>
        }
    </tbody>
</table>

@code {
    [Parameter] 
    public EventCallback RefreshParentState { get; set; }

    [Parameter]
    public Dictionary<Budget, Dictionary<Section, List<Category>>>? AllSections { get; set; }

    [Parameter]
    public Section? _Section { get; set; }

    private void UpdateState()
    {
        DataManager.OrderLists();
        StateHasChanged();
        RefreshParentState.InvokeAsync();
    }
}
